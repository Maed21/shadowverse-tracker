<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>シャドバ戦績管理</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
h1 { text-align: center; }
select, button { margin: 5px; padding: 10px; font-size: 16px; }
button { cursor: pointer; }
.stats { margin-top: 20px; background: white; padding: 10px; border-radius: 8px; }
</style>
</head>
<body>

<h1>シャドバ戦績管理</h1>

<label>使用デッキ:
<select id="myDeck" onchange="showStats()">
  <option>ランプドラゴン</option>
  <option>アグロネクロ</option>
  <option>ロイヤル</option>
</select>
</label>

<br>

<label>相手のクラス:
<select id="opponentClass">
  <option>エルフ</option>
  <option>ビショップ</option>
  <option>ヴァンパイア</option>
</select>
</label>

<div>
  <button onclick="saveResult('勝ち')">勝ち</button>
  <button onclick="saveResult('負け')">負け</button>
</div>

<div class="stats" id="stats"></div>

<script>
let matches = JSON.parse(localStorage.getItem('matches')) || [];

function saveResult(result) {
  const deck = document.getElementById('myDeck').value;
  const opponent = document.getElementById('opponentClass').value;
  matches.push({ deck, opponent, result });
  localStorage.setItem('matches', JSON.stringify(matches));
  showStats();
}

function showStats() {
  const selectedDeck = document.getElementById('myDeck').value;
  const deckMatches = matches.filter(m => m.deck === selectedDeck);

  if (deckMatches.length === 0) {
    document.getElementById('stats').innerHTML = `<p>${selectedDeck} の記録がありません</p>`;
    return;
  }

  let html = `<h3>${selectedDeck} の相手クラス別勝率</h3>`;

  // 相手クラスごとの勝率
  const opponents = [...new Set(deckMatches.map(m => m.opponent))];
  opponents.forEach(op => {
    const games = deckMatches.filter(m => m.opponent === op);
    const wins = games.filter(m => m.result === '勝ち').length;
    const winRate = (wins / games.length * 100).toFixed(1);
    html += `<p>${op}: ${winRate}% (${wins}勝/${games.length}試合)</p>`;
  });

  document.getElementById('stats').innerHTML = html;
}

showStats();
</script>

<script>
// PWA用のService Worker登録
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
