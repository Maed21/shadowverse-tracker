<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>シャドバ戦績管理</title>
<link rel="manifest" href="manifest.json" />
<style>
  body {
    font-family: sans-serif;
    padding: 20px;
    background: #12283D; /* 紺色を指定 */
    color: white; /* 文字色を白に変更 */
  }
  h1 {
    text-align: center;
  }
  select,
  button,
  input {
    margin: 5px;
    padding: 10px;
    font-size: 16px;
  }
  button {
    cursor: pointer;
  }
  .stats,
  .history {
    margin-top: 20px;
    background: transparent;
    padding: 10px;
    border-radius: 8px;
  }
  .list-item {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid #ddd;
  }
  .list-item:last-child {
    border-bottom: none;
  }
</style>
</head>
<body>
  <h1>シャドバ戦績管理</h1>

    <div>
    <label>使用デッキ:
      <select id="myDeck" onchange="showStats()"></select>
    </label>
    <input type="text" id="newDeck" placeholder="デッキ名を追加" />
    <button onclick="addDeck()">追加</button>
    <button onclick="removeDeck()">削除</button>
  </div>

  <br />

    <div>
    <label>相手のクラス:
      <select id="opponentClass"></select>
    </label>
    <input type="text" id="newClass" placeholder="クラス名を追加" />
    <button onclick="addClass()">追加</button>
    <button onclick="removeClass()">削除</button>
  </div>

    <div>
    <button onclick="saveResult('勝ち')">勝ち</button>
    <button onclick="saveResult('負け')">負け</button>
  </div>

    <div>
    <label>開始日: <input type="date" id="startDate"></label>
    <label>終了日: <input type="date" id="endDate"></label>
    <button onclick="showStats(); showHistory();">絞り込み</button>
  </div>
  
    <div class="stats" id="stats"></div>

    <div class="history" id="history"></div>

  <script>
    // 安全にlocalStorageから配列を取得、無効なら初期値をセット
    function loadOrDefault(key, defaultArray) {
      try {
        const data = JSON.parse(localStorage.getItem(key));
        if (Array.isArray(data) && data.length > 0) return data;
      } catch {}
      localStorage.setItem(key, JSON.stringify(defaultArray));
      return defaultArray;
    }

    let decks = loadOrDefault('decks', ['ランプドラゴン', 'アグロネクロ', 'ロイヤル']);
    let classes = loadOrDefault('classes', ['エルフ', 'ビショップ', 'ヴァンパイア']);
    let matches = JSON.parse(localStorage.getItem('matches')) || [];

    // 初期化
    function initSelectOptions() {
      const deckSelect = document.getElementById('myDeck');
      deckSelect.innerHTML = '';
      decks.forEach(d => {
        let opt = document.createElement('option');
        opt.textContent = d;
        deckSelect.appendChild(opt);
      });

      const classSelect = document.getElementById('opponentClass');
      classSelect.innerHTML = '';
      classes.forEach(c => {
        let opt = document.createElement('option');
        opt.textContent = c;
        classSelect.appendChild(opt);
      });
    }

    function addDeck() {
      const val = document.getElementById('newDeck').value.trim();
      if (val && !decks.includes(val)) {
        decks.push(val);
        localStorage.setItem('decks', JSON.stringify(decks));
        initSelectOptions();
        document.getElementById('newDeck').value = '';
      }
    }

    function removeDeck() {
      const val = document.getElementById('myDeck').value;
      decks = decks.filter(d => d !== val);
      localStorage.setItem('decks', JSON.stringify(decks));
      matches = matches
