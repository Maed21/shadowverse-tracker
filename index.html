<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>シャドバ戦績管理</title>
<link rel="manifest" href="manifest.json" />
<style>
  body {
    font-family: sans-serif;
    padding: 20px;
    background: #12283D; /* 紺色を指定 */
    color: white; /* 文字色を白に変更 */
  }
  h1 {
    text-align: center;
  }
  select,
  button,
  input {
    margin: 5px;
    padding: 10px;
    font-size: 16px;
  }
  button {
    cursor: pointer;
  }
  .stats,
  .history {
    margin-top: 20px;
    background: transparent;
    padding: 10px;
    border-radius: 8px;
  }
  .list-item {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid #ddd;
  }
  .list-item:last-child {
    border-bottom: none;
  }
  .add-form, .remove-form {
    display: none; /* デフォルトで非表示 */
    margin-top: 10px;
  }
</style>
</head>
<body>
  <h1>シャドバ戦績管理</h1>

    <div>
    <label>使用デッキ: <select id="myDeck" onchange="showStats()"></select></label>
    <br />
    <label>相手のクラス: <select id="opponentClass"></select></label>
    <br />
    <button onclick="saveResult('勝ち')">勝ち</button>
    <button onclick="saveResult('負け')">負け</button>
  </div>

  <hr />

    <div>
    <button id="toggleAddDeckBtn" onclick="toggleAddForm('addDeckForm', 'toggleAddDeckBtn')">デッキ追加</button>
    <div id="addDeckForm" class="add-form">
      <input type="text" id="newDeck" placeholder="デッキ名を入力" />
      <button onclick="addDeck(); toggleAddForm('addDeckForm', 'toggleAddDeckBtn')">保存</button>
      <button onclick="toggleAddForm('addDeckForm', 'toggleAddDeckBtn')">キャンセル</button>
    </div>
    <button id="toggleRemoveDeckBtn" onclick="toggleRemoveForm('removeDeckForm', 'toggleRemoveDeckBtn', 'myDeck')">デッキ削除</button>
    <div id="removeDeckForm" class="remove-form">
      <label>削除するデッキ: <select id="removeDeckSelect"></select></label>
      <button onclick="removeDeck(); toggleRemoveForm('removeDeckForm', 'toggleRemoveDeckBtn', 'myDeck')">確定</button>
    </div>
  </div>

    <div>
    <button id="toggleAddClassBtn" onclick="toggleAddForm('addClassForm', 'toggleAddClassBtn')">クラス追加</button>
    <div id="addClassForm" class="add-form">
      <input type="text" id="newClass" placeholder="クラス名を入力" />
      <button onclick="addClass(); toggleAddForm('addClassForm', 'toggleAddClassBtn')">保存</button>
      <button onclick="toggleAddForm('addClassForm', 'toggleAddClassBtn')">キャンセル</button>
    </div>
    <button id="toggleRemoveClassBtn" onclick="toggleRemoveForm('removeClassForm', 'toggleRemoveClassBtn', 'opponentClass')">クラス削除</button>
    <div id="removeClassForm" class="remove-form">
      <label>削除するクラス: <select id="removeClassSelect"></select></label>
      <button onclick="removeClass(); toggleRemoveForm('removeClassForm', 'toggleRemoveClassBtn', 'opponentClass')">確定</button>
    </div>
  </div>

  <hr />

    <div>
    <label>開始日: <input type="date" id="startDate"></label>
    <label>終了日: <input type="date" id="endDate"></label>
    <button onclick="showStats(); showHistory();">絞り込み</button>
  </div>
  
    <div class="stats" id="stats"></div>

    <div class="history" id="history"></div>

  <script>
    // 安全にlocalStorageから配列を取得、無効なら初期値をセット
    function loadOrDefault(key, defaultArray) {
      try {
        const data = JSON.parse(localStorage.getItem(key));
        if (Array.isArray(data) && data.length > 0) return data;
      } catch {}
      localStorage.setItem(key, JSON.stringify(defaultArray));
      return defaultArray;
    }

    let decks = loadOrDefault('decks', ['ランプドラゴン', 'アグロネクロ', 'ロイヤル']);
    let classes = loadOrDefault('classes', ['エルフ', 'ビショップ', 'ヴァンパイア']);
    let matches = JSON.parse(localStorage.getItem('matches')) || [];

    // UIの表示・非表示を切り替える (追加用)
    function toggleAddForm(formId, buttonId) {
      const form = document.getElementById(formId);
      const button = document.getElementById(buttonId);
      if (form.style.display === 'block') {
        form.style.display = 'none';
        button.textContent = button.id === 'toggleAddDeckBtn' ? 'デッキ追加' : 'クラス追加';
      } else {
        form.style.display = 'block';
        button.textContent = '閉じる';
      }
    }

    // UI
